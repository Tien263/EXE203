@model Exe_Demo.Models.ViewModels.OrderManagementViewModel
@{
    ViewData["Title"] = "Qu·∫£n l√Ω ƒë∆°n h√†ng";
    Layout = "~/Views/Shared/_StaffLayout.cshtml";
}

<div class="container-fluid py-5">
    <!-- Page Header -->
    <div class="page-title mb-5">
        <div class="container">
            <div class="row align-items-center justify-content-between">
                <div class="col-auto">
                    <h2 style="margin: 0; color: white;">
                        <i class="fa fa-list-ul" style="margin-right: 12px;"></i>Qu·∫£n L√Ω ƒê∆°n H√†ng
                    </h2>
                </div>
                <div class="col-auto">
                    <a asp-action="ExportOrders" class="btn btn-light btn-sm" style="margin-right: 8px;">
                        <i class="fa fa-file-excel-o"></i> Xu·∫•t/Nh·∫≠p Excel
                    </a>
                    <a asp-action="Dashboard" class="btn btn-light btn-sm">
                        <i class="fa fa-arrow-left"></i> Quay l·∫°i
                    </a>
                </div>
                <div class="col-auto">
                    <form asp-action="ClearAllOrders" method="post" onsubmit="return confirm('C·∫¢NH B√ÅO: B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA H·∫æT t·∫•t c·∫£ ƒë∆°n h√†ng c≈© kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!');" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm">
                            <i class="fa fa-trash"></i> X√≥a H·∫øt ƒê∆°n H√†ng C≈©
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <!-- B·ªô l·ªçc -->
        <div class="card border-0 mb-5">
            <div class="card-header">
                <h5 style="margin-bottom: 0;">
                    <i class="fa fa-sliders" style="margin-right: 10px;"></i>B·ªô L·ªçc & T√¨m Ki·∫øm
                </h5>
            </div>
            <div class="card-body">
                <form method="get" asp-action="Orders">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label" style="font-weight: 600; color: #333;">T√¨m ki·∫øm</label>
                            <input type="text" name="search" class="form-control" 
                                   placeholder="M√£ ƒë∆°n, t√™n, SƒêT..." value="@Model.SearchTerm">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label" style="font-weight: 600; color: #333;">Tr·∫°ng th√°i</label>
                            <select name="status" class="form-select">
                                <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                                <option value="Ch·ªù x√°c nh·∫≠n" selected="@(Model.StatusFilter == "Ch·ªù x√°c nh·∫≠n")">Ch·ªù x√°c nh·∫≠n</option>
                                <option value="ƒêang x·ª≠ l√Ω" selected="@(Model.StatusFilter == "ƒêang x·ª≠ l√Ω")">ƒêang x·ª≠ l√Ω</option>
                                <option value="ƒêang giao" selected="@(Model.StatusFilter == "ƒêang giao")">ƒêang giao</option>
                                <option value="ƒê√£ ho√†n th√†nh" selected="@(Model.StatusFilter == "ƒê√£ ho√†n th√†nh")">ƒê√£ ho√†n th√†nh</option>
                                <option value="ƒê√£ h·ªßy" selected="@(Model.StatusFilter == "ƒê√£ h·ªßy")">ƒê√£ h·ªßy</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label" style="font-weight: 600; color: #333;">Thanh to√°n</label>
                            <select name="paymentStatus" class="form-select">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="Ch∆∞a thanh to√°n" selected="@(Model.PaymentStatusFilter == "Ch∆∞a thanh to√°n")">Ch∆∞a thanh to√°n</option>
                                <option value="ƒê√£ thanh to√°n" selected="@(Model.PaymentStatusFilter == "ƒê√£ thanh to√°n")">ƒê√£ thanh to√°n</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label" style="font-weight: 600; color: #333;">T·ª´ ng√†y</label>
                            <input type="date" name="fromDate" class="form-control" 
                                   value="@Model.FromDate?.ToString("yyyy-MM-dd")">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label" style="font-weight: 600; color: #333;">ƒê·∫øn ng√†y</label>
                            <input type="date" name="toDate" class="form-control" 
                                   value="@Model.ToDate?.ToString("yyyy-MM-dd")">
                        </div>
                        <div class="col-md-1 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fa fa-search"></i> <span class="d-none d-sm-inline">T√¨m</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Danh s√°ch ƒë∆°n h√†ng -->
        <div class="card border-0">
            <div class="card-header">
                <h5 style="margin-bottom: 0;">
                    <i class="fa fa-shopping-bag" style="margin-right: 10px;"></i>Danh S√°ch ƒê∆°n H√†ng
                </h5>
            </div>
            <div class="card-body p-0">
                @if (Model.Orders?.Count > 0)
                {
                    <div class="table-responsive">
                        <table class="table table-hover mb-0 align-middle">
                            <thead>
                                <tr>
                                    <th style="font-weight: 700;"><i class="fa fa-hashtag"></i> M√£ ƒê∆°n</th>
                                    <th style="font-weight: 700;"><i class="fa fa-user"></i> Kh√°ch H√†ng</th>
                                    <th style="font-weight: 700;"><i class="fa fa-phone"></i> SƒêT</th>
                                    <th style="font-weight: 700;"><i class="fa fa-money"></i> T·ªïng Ti·ªÅn</th>
                                    <th style="font-weight: 700; text-align: center;"><i class="fa fa-credit-card"></i> Thanh To√°n</th>
                                    <th style="font-weight: 700; text-align: center;"><i class="fa fa-info-circle"></i> Tr·∫°ng Th√°i</th>
                                    <th style="font-weight: 700;"><i class="fa fa-calendar"></i> Ng√†y ƒê·∫∑t</th>
                                    <th style="font-weight: 700; text-align: center; width: 80px;"><i class="fa fa-cog"></i></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var order in Model.Orders)
                                {
                                    <tr>
                                        <td style="font-weight: 700; color: #2d5016;">
                                            @order.OrderCode
                                        </td>
                                        <td>
                                            <div style="font-weight: 600;">@order.CustomerName</div>
                                        </td>
                                        <td>
                                            @order.CustomerPhone
                                        </td>
                                        <td style="font-weight: 700; color: #e74c3c; font-size: 15px;">
                                            @order.FinalAmount.ToString("N0") ƒë
                                        </td>
                                        <td style="text-align: center;">
                                            @if (order.PaymentStatus == "ƒê√£ thanh to√°n")
                                            {
                                                <span class="badge bg-success">‚úì Thanh to√°n</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-danger">‚úó Ch∆∞a thanh to√°n</span>
                                            }
                                        </td>
                                        <td style="text-align: center;">
                                            @if (order.OrderStatus == "ƒê√£ ho√†n th√†nh")
                                            {
                                                <span class="badge bg-success">‚úì Ho√†n th√†nh</span>
                                            }
                                            else if (order.OrderStatus == "Ch·ªù x√°c nh·∫≠n")
                                            {
                                                <span class="badge bg-warning">‚è≥ Ch·ªù x√°c nh·∫≠n</span>
                                            }
                                            else if (order.OrderStatus == "ƒêang x·ª≠ l√Ω")
                                            {
                                                <span class="badge bg-info">üîÑ X·ª≠ l√Ω</span>
                                            }
                                            else if (order.OrderStatus == "ƒêang giao")
                                            {
                                                <span class="badge bg-primary">üöö Giao h√†ng</span>
                                            }
                                            else if (order.OrderStatus == "ƒê√£ h·ªßy")
                                            {
                                                <span class="badge bg-danger">‚úó H·ªßy</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary">@order.OrderStatus</span>
                                            }
                                        </td>
                                        <td>
                                            <small style="display: block;">@order.CreatedDate?.AddHours(7).ToString("dd/MM/yyyy")</small>
                                            <small class="text-muted">@order.CreatedDate?.AddHours(7).ToString("HH:mm")</small>
                                        </td>
                                        <td style="text-align: center;">
                                            <a asp-action="OrderDetail" asp-route-id="@order.OrderId" 
                                               class="btn btn-primary btn-sm" title="Xem chi ti·∫øt">
                                                <i class="fa fa-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div style="padding: 3rem; text-align: center; color: #999;">
                        <i class="fa fa-inbox fa-3x mb-3" style="opacity: 0.3;"></i>
                        <p style="font-size: 16px;">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o</p>
                    </div>
                }
            </div>

            <!-- Pagination -->
            @if (Model.TotalPages > 1)
            {
                <div class="card-footer bg-light">
                    <nav>
                        <ul class="pagination justify-content-center mb-0" style="gap: 4px;">
                            @if (Model.CurrentPage > 1)
                            {
                                <li class="page-item">
                                    <a class="page-link" asp-action="Orders" 
                                       asp-route-page="@(Model.CurrentPage - 1)"
                                       asp-route-search="@Model.SearchTerm"
                                       asp-route-status="@Model.StatusFilter"
                                       asp-route-paymentStatus="@Model.PaymentStatusFilter"
                                       asp-route-fromDate="@Model.FromDate?.ToString("yyyy-MM-dd")"
                                       asp-route-toDate="@Model.ToDate?.ToString("yyyy-MM-dd")">
                                        <i class="fa fa-chevron-left"></i> Tr∆∞·ªõc
                                    </a>
                                </li>
                            }

                            @for (int i = 1; i <= Model.TotalPages; i++)
                            {
                                <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                    <a class="page-link" asp-action="Orders" 
                                       asp-route-page="@i"
                                       asp-route-search="@Model.SearchTerm"
                                       asp-route-status="@Model.StatusFilter"
                                       asp-route-paymentStatus="@Model.PaymentStatusFilter"
                                       asp-route-fromDate="@Model.FromDate?.ToString("yyyy-MM-dd")"
                                       asp-route-toDate="@Model.ToDate?.ToString("yyyy-MM-dd")">@i</a>
                                </li>
                            }

                            @if (Model.CurrentPage < Model.TotalPages)
                            {
                                <li class="page-item">
                                    <a class="page-link" asp-action="Orders" 
                                       asp-route-page="@(Model.CurrentPage + 1)"
                                       asp-route-search="@Model.SearchTerm"
                                       asp-route-status="@Model.StatusFilter"
                                       asp-route-paymentStatus="@Model.PaymentStatusFilter"
                                       asp-route-fromDate="@Model.FromDate?.ToString("yyyy-MM-dd")"
                                       asp-route-toDate="@Model.ToDate?.ToString("yyyy-MM-dd")">
                                        Sau <i class="fa fa-chevron-right"></i>
                                    </a>
                                </li>
                            }
                        </ul>
                    </nav>
                </div>
            }
        </div>
    </div>
</div>

